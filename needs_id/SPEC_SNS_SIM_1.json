{"created": "2025-11-12T08:43:41.278735", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T08:43:41.278718", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_SNS_SIM_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Design:** Provide a simulator implementation for the distance sensor that implements the\nfull public API declared in ``distance_sensor.h`` while replacing ISR/GPIO timing with a\ndeterministic simulated data producer.\n\n**Implementation:**\n\n- API Compatibility: The simulator SHALL implement ``distance_sensor_init()``, ``distance_sensor_start()``,\n  ``distance_sensor_get_latest()`` and all other public functions with identical signatures\n  and return codes\n- Queue Semantics: The simulator MUST produce ``distance_measurement_t`` entries on the\n  processed queue with the same semantics as the hardware task (blocking consumers, identical\n  status codes for out-of-range/timeouts when simulated)\n- Animation Pattern: Deterministic sweep from 5cm to 60cm and back in 1mm steps, advancing\n  once per second\n- Isolation: Simulator implementation SHOULD be in ``distance_sensor_sim.c`` and selected\n  via CMake when ``CONFIG_TARGET_EMULATOR=y`` without modifying headers or higher-level\n  application code\n\n**Validation:** Simulator build compiles, ``distance_sensor_get_latest()`` receives simulated\nmeasurements at \u22481Hz, and status codes match expectations.\n\n**Example Implementation Pattern:**\n\n.. code-block:: c\n\n   // Simulated sensor with animated distance sweep\n   static void distance_sensor_task(void* pvParameters) {\n       static uint16_t sim_distance = 50;  // Start at 5cm\n       static int8_t direction = 1;        // 1 = increasing, -1 = decreasing\n\n       while(1) {\n           // Animate distance: 5cm \u2192 60cm \u2192 5cm (1mm steps)\n           sim_distance += direction;\n           if (sim_distance >= 600) direction = -1;  // 60cm\n           if (sim_distance <= 50)  direction = 1;   // 5cm\n\n           distance_measurement_t sim_data = {\n               .distance_mm = sim_distance,\n               .timestamp_us = esp_timer_get_time(),\n               .status = DISTANCE_SENSOR_OK\n           };\n\n           xQueueSend(processed_measurement_queue, &sim_data, portMAX_DELAY);\n           vTaskDelay(pdMS_TO_TICKS(1000));  // 1 second steps\n       }\n   }", "created_at": "", "docname": "12_design/spec_distance_sensor", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_SNS_SIM_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 185, "links": ["REQ_SYS_SIM_1", "SPEC_SNS_ARCH_1"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Simulator Specification", "sections": ["Simulator Specification", "Distance Sensor Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["sensor", "simulator", "qemu"], "template": null, "title": "Distance Sensor Simulator Design", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}