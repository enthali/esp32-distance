{"created": "2025-11-12T12:22:13.737691", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T12:22:13.737677", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_CFG_JSON_TYPESAFETY_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Description:** Achieving type safety through API design and optional validation rather than mandatory code generation.\n\n**Type Safety Mechanisms:**\n\n1. **API Signature Type Safety:**\n\n.. code-block:: c\n\n   // Compiler enforces types at call site\n   int32_t count;\n   config_get_int32(\"led_count\", &count);  // \u2705 Correct: matches schema type\n\n   char* str;\n   config_get_int32(\"wifi_ssid\", (int32_t*)str);  // \u274c Logical error (caught by developer testing)\n\n2. **Schema Documents Correct Type:**\n\n.. code-block:: json\n\n   {\"key\": \"led_count\", \"type\": \"integer\"}   \u2192 Use config_get_int32()\n   {\"key\": \"wifi_ssid\", \"type\": \"string\"}    \u2192 Use config_get_string()\n\n3. **Optional: Static Validator Script (Nice-to-Have):**\n\n.. code-block:: python\n\n   # Pre-build validation (not required)\n   python3 tools/validate_config_schema.py\n\n   # Finds type mismatches in code:\n   # ERROR: src/main.c:42 - config_get_int32(\"wifi_ssid\"):\n   #        schema says type=\"string\", not integer\n\n**When Type Mismatches Happen:**\n\n- \u274c If schema says `\"string\"` but code calls `config_get_int32()`:\n  - Result: Reads binary garbage as integer\n  - Discovery: Runtime error during testing (type mismatch obvious)\n  - Recovery: Trivial fix (change one line in C code)\n\n**For Templates, This is Acceptable:**\n\n- Small number of config fields (5-10 typically)\n- Type errors obvious after one test run\n- No runtime overhead of validation\n- Code remains simple and understandable\n\n**When Additional Safety is Needed:**\n\n- Projects with 20+ config fields\n- Pre-commit validator script (optional)\n- Or: Use code generation approach (separate branch/option)\n\n**Design Philosophy:**\n\n- **Explicit > Implicit**: Keys appear in both JSON and C code (obvious when they match)\n- **Simple > Magic**: No hidden code generation unless chosen\n- **Learnable > Complex**: Beginners can understand entire system quickly", "created_at": "", "docname": "12_design/spec_config_manager_json", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_CFG_JSON_TYPESAFETY_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 668, "links": ["REQ_CFG_JSON_7", "REQ_CFG_JSON_14"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Best Practices & Development Guide", "sections": ["Best Practices & Development Guide", "JSON-Based Configuration Manager Design"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["type-safety", "best-practices"], "template": null, "title": "Type Safety Without Code Generation", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}