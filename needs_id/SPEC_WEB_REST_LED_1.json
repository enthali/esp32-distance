{"created": "2025-11-12T08:43:41.286892", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T08:43:41.286875", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_WEB_REST_LED_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Endpoint: GET /api/led/state**\n\n**Purpose:** Retrieve current LED strip state for real-time web visualization\n\n**Response:**\n\n.. code-block:: json\n\n   {\n     \"led_count\": 40,\n     \"colors\": \"FF0000 00FF00 0000FF 000000 FFFFFF ...\"\n   }\n\n**Response Format:**\n\n- ``led_count``: Number of LEDs in the strip (matches configuration)\n- ``colors``: Space-separated hex RGB colors (e.g., \"FF0000\" = red, \"000000\" = off)\n- Each color: 6 hex digits (RRGGBB format)\n- Total response size: ~280 bytes for 40 LEDs + JSON overhead\n\n**Implementation Details:**\n\n.. code-block:: c\n\n   // Handler function\n   static esp_err_t led_state_handler(httpd_req_t *req)\n   {\n       // 1. Set CORS headers for cross-origin access\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n       httpd_resp_set_hdr(req, \"Content-Type\", \"application/json\");\n\n       // 2. Get LED count from controller\n       uint16_t led_count = led_get_count();\n\n       // 3. Allocate snapshot buffer\n       led_color_t *snapshot = malloc(led_count * sizeof(led_color_t));\n\n       // 4. Get thread-safe snapshot using REQ_LED_5 API\n       uint16_t actual = led_get_all_colors(snapshot, led_count);\n\n       // 5. Convert RGB to hex string: \"RRGGBB RRGGBB ...\"\n       //    Format: sprintf(pos, \"%02X%02X%02X\", r, g, b)\n\n       // 6. Build JSON response\n       // 7. Send response\n       // 8. Free buffers\n   }\n\n**Error Handling:**\n\n- LED controller not initialized \u2192 500 Internal Server Error\n- Memory allocation failure \u2192 500 Internal Server Error\n- Snapshot read failure \u2192 500 Internal Server Error\n- All errors log to console for debugging\n\n**Performance:**\n\n- Typical response time: <100ms for 40 LEDs\n- Memory usage: ~600 bytes (LED snapshot + hex string buffers)\n- Thread-safe: Uses mutex-protected ``led_get_all_colors()``\n- No blocking of LED updates: Snapshot operation is fast\n\n**Use Cases:**\n\n- Real-time LED strip visualization in web UI\n- Remote monitoring of LED states\n- JavaScript canvas/CSS LED animation sync\n- Debugging LED display issues\n\n**CORS Support:**\n\n- Access-Control-Allow-Origin: * (allows cross-origin requests)\n- Enables local development and external web apps", "created_at": "", "docname": "12_design/spec_web_server", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_WEB_REST_LED_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 633, "links": ["REQ_WEB_LED_1", "SPEC_LED_API_3"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Configuration API Design", "sections": ["Configuration API Design", "Web Server Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["web", "api", "led", "visualization"], "template": null, "title": "LED State API Endpoint", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}