{"created": "2025-11-12T08:43:41.288096", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T08:43:41.288080", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_WEB_SECURITY_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Current CORS Policy:**\n\nAll API endpoints return:\n\n.. code-block:: c\n\n   httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n\n**Rationale:** Template simplicity - allows development from any origin (GitHub Pages, local files, etc.)\n\n**Production Recommendation:**\n\nFor production deployments, restrict CORS to specific origins:\n\n.. code-block:: c\n\n   // Option 1: Lock to device IP only (no external access)\n   httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"null\");\n\n   // Option 2: Allow specific external domain (hybrid GitHub Pages approach)\n   httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\",\n                     \"https://yourusername.github.io\");\n\n**CORS Preflight Handler:**\n\n.. code-block:: c\n\n   static esp_err_t cors_preflight_handler(httpd_req_t *req)\n   {\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n       httpd_resp_set_hdr(req, \"Access-Control-Max-Age\", \"86400\"); // 24 hours\n       httpd_resp_send(req, \"\", 0);\n       return ESP_OK;\n   }\n\nRegistered for:\n\n.. code-block:: c\n\n   httpd_uri_t options_uri = {\n       .uri = \"/api/*\",    // Wildcard for all API endpoints\n       .method = HTTP_OPTIONS,\n       .handler = cors_preflight_handler,\n       .user_ctx = NULL\n   };\n\n**Password Exposure Protection:**\n\nConfiguration GET endpoints never return password fields:\n\n.. code-block:: c\n\n   cJSON_AddStringToObject(wifi, \"password\", \"\");  // Always empty string\n\nPasswords are only accepted in POST requests, never echoed back.", "created_at": "", "docname": "12_design/spec_web_server", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_WEB_SECURITY_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 1102, "links": ["REQ_WEB_5"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "CORS and Security", "sections": ["CORS and Security", "Web Server Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["web", "security", "cors"], "template": null, "title": "CORS Configuration", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}