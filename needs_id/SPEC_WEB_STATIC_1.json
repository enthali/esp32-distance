{"created": "2025-11-12T10:41:15.297597", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T10:41:15.297583", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_WEB_STATIC_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Problem:**\nESP32 has no filesystem by default. HTML/CSS/JS files must be embedded in firmware flash.\n\n**Solution:**\nUse ESP-IDF's ``EMBED_FILES`` CMake directive to convert static files into binary symbols at build time.\n\n**CMakeLists.txt Configuration:**\n\n.. code-block:: cmake\n\n   idf_component_register(\n       SRCS \"web_server.c\" \"wifi_manager.c\"\n       INCLUDE_DIRS \".\"\n       EMBED_FILES\n           \"www/index.html\"\n           \"www/wifi-setup.html\"\n           \"www/settings.html\"\n           \"www/favicon.svg\"\n           \"www/css/style.css\"\n           \"www/js/app.js\"\n       REQUIRES\n           config_manager\n           esp_wifi\n           esp_http_server\n           json\n   )\n\n**Generated Binary Symbols:**\n\nFor each file ``path/to/file.ext``, CMake generates:\n\n- ``_binary_file_ext_start``: Pointer to start of file data\n- ``_binary_file_ext_end``: Pointer to end of file data\n\n**C Code Access:**\n\n.. code-block:: c\n\n   extern const uint8_t index_html_start[] asm(\"_binary_index_html_start\");\n   extern const uint8_t index_html_end[] asm(\"_binary_index_html_end\");\n\n   size_t size = index_html_end - index_html_start;\n   httpd_resp_send(req, (const char*)index_html_start, size);\n\n**File Lookup Function:**\n\nThe ``get_embedded_file()`` function maps URI paths to embedded file symbols:\n\n.. code-block:: c\n\n   static esp_err_t get_embedded_file(const char *filename,\n                                      const uint8_t **data,\n                                      size_t *size)\n   {\n       // Strip query parameters (?v=2 for cache busting)\n       char clean_filename[128];\n       strncpy(clean_filename, filename, sizeof(clean_filename) - 1);\n       char *query = strchr(clean_filename, '?');\n       if (query != NULL) *query = '\\0';\n\n       if (strcmp(clean_filename, \"/index.html\") == 0) {\n           *data = index_html_start;\n           *size = index_html_end - index_html_start;\n       }\n       // ... more file mappings ...\n       else {\n           return ESP_ERR_NOT_FOUND;\n       }\n       return ESP_OK;\n   }\n\n**MIME Type Detection:**\n\n.. code-block:: c\n\n   static const char *get_mime_type(const char *filename)\n   {\n       const char *ext = strrchr(filename, '.');\n       if (strcmp(ext, \".html\") == 0) return \"text/html\";\n       if (strcmp(ext, \".css\") == 0) return \"text/css\";\n       if (strcmp(ext, \".js\") == 0) return \"application/javascript\";\n       if (strcmp(ext, \".svg\") == 0) return \"image/svg+xml\";\n       if (strcmp(ext, \".json\") == 0) return \"application/json\";\n       return \"text/plain\";\n   }\n\n**Cache Control:**\n\nFor template/development, caching is disabled:\n\n.. code-block:: c\n\n   httpd_resp_set_hdr(req, \"Cache-Control\", \"no-cache, no-store, must-revalidate\");\n   httpd_resp_set_hdr(req, \"Pragma\", \"no-cache\");\n   httpd_resp_set_hdr(req, \"Expires\", \"0\");", "created_at": "", "docname": "12_design/spec_web_server", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_WEB_STATIC_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 79, "links": ["REQ_WEB_1", "REQ_WEB_2", "REQ_WEB_3", "REQ_WEB_NF_1"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Static File Embedding", "sections": ["Static File Embedding", "Web Server Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["web", "build", "embedding"], "template": null, "title": "Static File Embedding Strategy", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}