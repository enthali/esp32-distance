{"created": "2025-11-12T12:22:13.747318", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-12T12:22:13.747305", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_WEB_INTEGRATION_CFG_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Integration Points:**\n\nThe web server integrates with the config manager component through a well-defined C API:\n\n**Include Header:**\n\n.. code-block:: c\n\n   #include \"config_manager.h\"  // Provides config_get_*, config_set_* functions\n\n**Reading Configuration:**\n\n.. code-block:: c\n\n   char wifi_ssid[CONFIG_STRING_MAX_LEN + 1];\n   uint16_t led_count;\n\n   esp_err_t ret = config_get_string(CONFIG_WIFI_SSID, wifi_ssid, sizeof(wifi_ssid));\n   if (ret != ESP_OK) {\n       ESP_LOGE(TAG, \"Failed to get WiFi SSID: %s\", esp_err_to_name(ret));\n       // Use default or return error to client\n   }\n\n   config_get_uint16(CONFIG_LED_COUNT, &led_count);\n\n**Writing Configuration:**\n\n.. code-block:: c\n\n   const char *new_ssid = \"NewNetwork\";\n   esp_err_t ret = config_set_string(CONFIG_WIFI_SSID, new_ssid);\n   if (ret != ESP_OK) {\n       ESP_LOGE(TAG, \"Failed to set WiFi SSID: %s\", esp_err_to_name(ret));\n       httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, \"Invalid WiFi SSID\");\n       return ESP_FAIL;\n   }\n\n**Factory Reset:**\n\n.. code-block:: c\n\n   esp_err_t ret = config_factory_reset();\n   if (ret != ESP_OK) {\n       httpd_resp_send_err(req, HTTPD_500_INTERNAL_SERVER_ERROR, \"Factory reset failed\");\n       return ESP_FAIL;\n   }\n\n**Error Code Mapping:**\n\n============================  =================================  ===============\nConfig Manager Error          HTTP Status Code                   Response Action\n============================  =================================  ===============\n``ESP_OK``                    200 OK                             Return data/success\n``ESP_ERR_INVALID_ARG``       400 Bad Request                    Invalid parameter\n``ESP_ERR_NVS_NOT_FOUND``     404 Not Found                      Key doesn't exist\n``ESP_ERR_NO_MEM``            500 Internal Server Error          Memory allocation failed\n``ESP_FAIL`` (NVS error)      500 Internal Server Error          Storage error\n============================  =================================  ===============\n\n**Separation of Concerns:**\n\n- **Config Manager** owns NVS storage logic, key-value mapping, defaults\n- **Web Server** owns HTTP protocol, JSON serialization, client interaction\n- **Interface:** Simple C function calls with ``esp_err_t`` return codes\n\n**Note:** Config Manager does NOT know about HTTP, JSON, or web interfaces. Web Server does NOT know about NVS internals or storage keys.", "created_at": "", "docname": "12_design/spec_web_server", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_WEB_INTEGRATION_CFG_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 719, "links": ["REQ_WEB_CONF_1", "REQ_CFG_JSON_10"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Configuration Manager Integration", "sections": ["Configuration Manager Integration", "Web Server Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["web", "integration", "config"], "template": null, "title": "Config Manager Integration Pattern", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}