{"created": "2025-11-13T12:53:52.815897", "current_version": "", "project": "ESP32 Distance Sensor", "versions": {"": {"created": "2025-11-13T12:53:52.815883", "creator": {"program": "sphinx_needs", "version": "6.1.0"}, "needs": {"SPEC_WEB_REST_CFG_1": {"acceptance_criteria": "", "api_signature": "", "arch": {}, "avatar": "", "closed_at": "", "completion": null, "component": "", "constraints": [], "constraints_error": null, "constraints_passed": true, "constraints_results": {}, "content": "**Architecture:**\nThe web server provides HTTP transport for configuration operations. All configuration logic is delegated to the config manager component.\n\n**Endpoints:**\n\n1. ``GET /api/config/schema`` - Retrieve JSON schema for UI generation\n2. ``GET /api/config`` - Retrieve all configuration values\n3. ``POST /api/config`` - Update configuration values\n\n---\n\n**Endpoint: GET /api/config/schema**\n\n**Purpose:** Return JSON schema for frontend UI generation\n\n**Request:** None\n\n**Response (200 OK):**\n\n.. code-block:: json\n\n   {\n     \"title\": \"ESP32 Device Configuration\",\n     \"version\": \"1.0.0\",\n     \"fields\": [\n       {\n         \"key\": \"wifi_ssid\",\n         \"type\": \"string\",\n         \"label\": \"WiFi Network Name\",\n         \"default\": \"\",\n         \"required\": false,\n         \"maxLength\": 63,\n         \"group\": \"wifi\"\n       },\n       {\n         \"key\": \"ap_ssid\",\n         \"type\": \"string\",\n         \"label\": \"AP SSID\",\n         \"default\": \"ESP32-Setup\",\n         \"required\": true,\n         \"maxLength\": 32,\n         \"group\": \"ap\"\n       }\n     ]\n   }\n\n**Implementation:**\n\n.. code-block:: c\n\n   static esp_err_t schema_get_handler(httpd_req_t *req)\n   {\n       httpd_resp_set_hdr(req, \"Content-Type\", \"application/json\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n\n       char *schema_json = NULL;\n       esp_err_t ret = config_get_schema_json(&schema_json);\n       if (ret != ESP_OK) {\n           httpd_resp_send_err(req, HTTPD_500_INTERNAL_SERVER_ERROR,\n                               \"Failed to load configuration schema\");\n           return ESP_FAIL;\n       }\n\n       httpd_resp_send(req, schema_json, HTTPD_RESP_USE_STRLEN);\n       // Note: schema_json points to embedded flash data, no free() needed\n\n       return ESP_OK;\n   }\n\n---\n\n**Endpoint: GET /api/config**\n\n**Purpose:** Retrieve all current configuration values\n\n**Request:** None\n\n**Response (200 OK):**\n\n.. code-block:: json\n\n   {\n     \"wifi_ssid\": \"MyNetwork\",\n     \"wifi_pass\": \"\",\n     \"ap_ssid\": \"ESP32-Setup\",\n     \"ap_pass\": \"12345678\",\n     \"led_count\": 50,\n     \"led_bright\": 128,\n     \"device_name\": \"MyDevice\"\n   }\n\n**Implementation:**\n\n.. code-block:: c\n\n   static esp_err_t config_get_handler(httpd_req_t *req)\n   {\n       httpd_resp_set_hdr(req, \"Content-Type\", \"application/json\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n\n       char *config_json = NULL;\n       esp_err_t ret = config_get_all_as_json(&config_json);\n       if (ret != ESP_OK) {\n           httpd_resp_send_err(req, HTTPD_500_INTERNAL_SERVER_ERROR,\n                               \"Failed to read configuration\");\n           return ESP_FAIL;\n       }\n\n       httpd_resp_send(req, config_json, HTTPD_RESP_USE_STRLEN);\n       free(config_json);\n\n       return ESP_OK;\n   }\n\n---\n\n**Endpoint: POST /api/config**\n\n**Purpose:** Update configuration values\n\n**Request Body:**\n\n.. code-block:: json\n\n   {\n     \"wifi_ssid\": \"NewNetwork\",\n     \"wifi_pass\": \"newpassword123\",\n     \"ap_ssid\": \"MyDevice-AP\",\n     \"led_count\": 144,\n     \"device_name\": \"UpdatedDevice\"\n   }\n\n**Response (200 OK):**\n\n.. code-block:: json\n\n   {\n     \"status\": \"success\",\n     \"message\": \"Configuration saved successfully\"\n   }\n\n**Implementation:**\n\n.. code-block:: c\n\n   static esp_err_t config_set_handler(httpd_req_t *req)\n   {\n       httpd_resp_set_hdr(req, \"Content-Type\", \"application/json\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n\n       // Read request body\n       char content[1024];\n       int ret = httpd_req_recv(req, content, sizeof(content) - 1);\n       if (ret <= 0) {\n           httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, \"Invalid request body\");\n           return ESP_FAIL;\n       }\n       content[ret] = '\\0';\n\n       esp_err_t config_ret = config_set_all_from_json(content);\n       if (config_ret != ESP_OK) {\n           httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, \"Configuration update failed\");\n           return ESP_FAIL;\n       }\n\n       const char *response = \"{\\\"status\\\":\\\"success\\\",\\\"message\\\":\\\"Configuration saved successfully\\\"}\";\n       httpd_resp_send(req, response, HTTPD_RESP_USE_STRLEN);\n\n       return ESP_OK;\n   }\n\n---\n\n**Endpoint: POST /api/config/reset**\n\n**Purpose:** Reset all configuration to factory defaults\n\n**Request:** None\n\n**Response (200 OK):**\n\n.. code-block:: json\n\n   {\n     \"status\": \"success\",\n     \"message\": \"Configuration reset to factory defaults\"\n   }\n\n**Implementation:**\n\n.. code-block:: c\n\n   static esp_err_t config_reset_handler(httpd_req_t *req)\n   {\n       httpd_resp_set_hdr(req, \"Content-Type\", \"application/json\");\n       httpd_resp_set_hdr(req, \"Access-Control-Allow-Origin\", \"*\");\n\n       esp_err_t ret = config_factory_reset();\n       if (ret != ESP_OK) {\n           httpd_resp_send_err(req, HTTPD_500_INTERNAL_SERVER_ERROR,\n                               \"Factory reset failed\");\n           return ESP_FAIL;\n       }\n\n       const char *response = \"{\\\"status\\\":\\\"success\\\",\\\"message\\\":\\\"Configuration reset to factory defaults\\\"}\";\n       httpd_resp_send(req, response, HTTPD_RESP_USE_STRLEN);\n       return ESP_OK;\n   }", "created_at": "", "docname": "12_design/spec_web_server", "doctype": ".rst", "duration": null, "external_css": "external_link", "external_url": null, "has_dead_links": false, "has_forbidden_dead_links": false, "header_file": "", "id": "SPEC_WEB_REST_CFG_1", "id_prefix": "", "is_external": false, "is_import": false, "is_modified": false, "jinja_content": false, "layout": null, "lineno": 279, "links": ["REQ_WEB_CONF_1", "REQ_WEB_SCHEMA_1"], "links_back": [], "max_amount": "", "max_content_lines": "", "modifications": 0, "parameters": "", "params": "", "parent_need": null, "parent_needs": [], "parent_needs_back": [], "parts": {}, "post_content": null, "post_template": null, "pre_content": null, "pre_template": null, "prefix": "", "priority": "", "query": "", "rationale": "", "returns": "", "section_name": "Configuration API Design", "sections": ["Configuration API Design", "Web Server Design Specification"], "service": "", "signature": null, "specific": "", "status": "approved", "style": null, "tags": ["web", "api", "config", "schema"], "template": null, "title": "Configuration API Endpoints", "type": "spec", "type_name": "Design Specification", "updated_at": "", "url": "", "url_postfix": "", "user": ""}}, "needs_amount": 1}}}